// SPDX-License-Identifier: MIT

pragma solidity ^0.8.17;


contract AutoGenerate {

    //error
    error addressMismatching();

    uint public autoGenerateId = 1000;
    uint[] public autoIds;
    address[] public allUserAddresses;
    UserAddressAndIdDetails[] public userDetails;

    // string private name;

     struct UserInformation{
        string firstName;
        string lastName;
        string email;
        uint phoneNumber;
        address walletAddress;
    }

    struct UserAddressAndIdDetails {
        address userAddress;
        uint userId;
    }

    mapping(address => mapping(uint => bool)) private checkUserAddressAndIdLinked;
    mapping(address => mapping(uint => UserInformation)) private userInfostruct;
    mapping(uint => address) private linkIdToUserAddress;


    function Add( UserInformation memory _userInfo) public {
        UserInformation memory ui = _userInfo;

        if (msg.sender != ui.walletAddress){
            revert addressMismatching();
        }    

        uint incrementCreationId = 1;
        autoGenerateId = autoGenerateId + incrementCreationId;
        autoIds.push(autoGenerateId);

        userInfostruct[ui.walletAddress][autoGenerateId].firstName = ui.firstName;
        userInfostruct[ui.walletAddress][autoGenerateId].lastName = ui.lastName;
        userInfostruct[ui.walletAddress][autoGenerateId].email = ui.email;
        userInfostruct[ui.walletAddress][autoGenerateId].phoneNumber = ui.phoneNumber;
        userInfostruct[ui.walletAddress][autoGenerateId].walletAddress = ui.walletAddress;
        
        allUserAddresses.push(ui.walletAddress);
        linkIdToUserAddress[autoGenerateId] = ui.walletAddress;
        
        checkUserAddressAndIdLinked[ui.walletAddress][autoGenerateId] = true;

        userDetails.push(UserAddressAndIdDetails(ui.walletAddress, autoGenerateId));

    }

    function getAllIds() public view returns (uint[] memory autoId){
        return autoIds;
    }

    function checkUserVerification(address _userAddress, uint _userID) external view returns(bool){
        return checkUserAddressAndIdLinked[_userAddress][_userID];
    }

    function getUserDetails( address _userAddress, uint256 _userId) external view returns(
        string memory firstName,
        string memory lastName,
        string memory email,
        uint256 phoneNumber,
        address walletAddress
        ){
        return (
        userInfostruct[_userAddress][_userId].firstName,
        userInfostruct[_userAddress][_userId].lastName,
        userInfostruct[_userAddress][_userId].email,
        userInfostruct[_userAddress][_userId].phoneNumber,
        userInfostruct[_userAddress][_userId].walletAddress
        );

    }

    function getUserDetailsStruct( address _userAddress, uint256 _userId) external view returns(
        UserInformation memory _userDetails){
        return (
        userInfostruct[_userAddress][_userId]
        );
    }

//     function getAllUserDetails() external view returns (UserInformation[] memory _allUderDetails)
//     {    
//     UserInformation[] memory userDetails = new UserInformation[](autoIds.length);
//     for (uint i = 0; i < autoIds.length; i++) {
//         UserInformation memory userInfo;
            
//         userInfo.firstName = userInfostruct[autoIds[i]].firstName;
//         userInfostruct[autoIds[i]].lastName;
//         userInfostruct[autoIds[i]].email;
//         userInfostruct[autoIds[i]].phoneNumber;
//         userInfostruct[autoIds[i]].walletAddress;
//         userDetails[i] = userInfo;

            // brokerInfo.id = brokerStruct[brokerIds[i]].id;
            // brokerInfo.firstName = brokerStruct[brokerIds[i]].firstName;
            // brokerInfo.lastName = brokerStruct[brokerIds[i]].lastName;
            // brokerInfo._address = brokerStruct[brokerIds[i]]._address;
            // detailss[i] = userInfo;
//     }
//     return userDetails;
// }

    // Get all user details

    function getAllUserDetails() external view returns (UserInformation[] memory) {
        UserInformation[] memory userDetail = new UserInformation[](autoIds.length);
        for (uint i = 0; i < autoIds.length; i++) {
            userDetail[i] = userInfostruct[linkIdToUserAddress[autoIds[i]]][autoIds[i]];
        }
        return userDetail;
    }

    // Get all address
    function getAllUserAddresses() external view returns (address[] memory userAddresses){
        return allUserAddresses;
    }

    // function getAllUserAddressesAndIds() public view returns (address[] memory userAddresses, uint[] memory userId){
    //     return (allUserAddresses, autoIds);
    // }


    
    // Listing all ID and address

    // method 1

    // function getAllUserAddressesAndIds() public view returns (address[] memory userAddresses, uint[] memory userId){
    //     return (allUserAddresses, autoIds);
    // }

    function getAllUserAddressesAndIds() external view returns (UserAddressAndIdDetails[] memory usersAddressesAndId){
    return userDetails;
    }

    //UUPS
}